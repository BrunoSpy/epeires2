<?php 
    
    $branchname = shell_exec("git rev-parse --abbrev-ref HEAD"); //get the one that is always the branch name
    
    $revision = shell_exec("git log -n 1 --pretty=format:'%h' --abbrev-commit");
    
    $commit = shell_exec("git log -n 1 --pretty=format:'%s (%ci)' --abbrev-commit");
    
    $tag = shell_exec("git describe --exact-match --tags");
    
    $hasTag = ! (substr($tag, 0, strlen("fatal")) === "fatal" || substr($tag, 0, strlen("warning")) === "warning" || empty($tag));
?>
<div class="container-fluid">
	<div class="row-fluid">
            	<div class="span12">
			<div class="block">
				<div class="navbar navbar-inner block-header">
					<div class="muted pull-left">Version</div>
				</div>
				<div class="block-content collapse in">
					<div class="span12">
                                            <p> Branche : <em><?php echo $branchname; ?></em></p>
                                            <?php if($hasTag) { echo '<p> Tag : <em>'.$tag.'</em></p>'; }?>
                                            <p> Révision : <em><?php echo $revision." : ".$commit; ?></em></p>
					</div>
				</div>
			</div>
		</div>
        </div>
        <div class="row-fluid">
            	<div class="span12">
			<div class="block">
				<div class="navbar navbar-inner block-header">
					<div class="muted pull-left">Base de données</div>
				</div>
				<div class="block-content collapse in">
					<div class="span12">
                                            <?php if($this->migrations != '0') : ?>
                                            <div class="alert alert-error">
                                                <strong>Attention !</strong> La base de données n'est pas à jour !
                                            </div>
                                            <?php endif; ?>
                                            <p> Base de données : <em><?php echo $this->db;?></em></p>
                                            <p> Table des migrations : <em><?php echo $this->table; ?></em></p>
                                            <p> Version courante : <em><?php echo $this->version; ?></em></p>
                                            <p> Dernière version : <em><?php echo $this->latestversion; ?></em></p>
                                            <p> Migrations non exécutées : <em><?php echo $this->migrations; ?></em></p>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>