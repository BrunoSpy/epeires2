<?php
    $class_alert = [
        'INCERFA' => 'info',
        'ALERFA' => 'warning',
        'DETRESFA' => 'danger'
    ];

    $typealert = (isset($ip['Alerte']['Type'])) ? $ip['Alerte']['Type'] : null;
?>
<li data-id="<?php echo $ip['id']; ?>" class="list-group-item list-group-item-<?php echo (array_key_exists($typealert, $class_alert)) ? $class_alert[$typealert] : 'primary'; ?>">
    <h1 class="list-group-item-heading"><button class="btn btn-sm btn-primary btn-cache-ip notinpdf" type="button">+</button><?php echo $ip['Type']; ?> <?php echo $ip['start_date']->format('\à H:i:s \l\e d-m-Y'); ?></h1>
    <div class = "list-ip-content cache">
        <h3 class="list-group-item-heading">Informations <a href="#mdl-start-ip" data-toggle="modal" class = "btn-edit-ip notinpdf">
        <span class="glyphicon glyphicon-pencil"></span>
        </a></h3>
        <p class="list-group-item-text">Latitude : <b><?php echo $ip['Latitude']?></b></p>
        <p class="list-group-item-text">Longitude : <b><?php echo $ip['Longitude']?></b></p>
        <p class="list-group-item-text">Type : <b><?php echo $ip['Type']?></b></p>
        <p class="list-group-item-text">Alerte : <b><?php echo (isset($typealert)) ? $typealert : NIL; ?></b></p>
        <!-- <h3 class="list-group-item-heading">Alerte</h3> -->
        <p class="list-group-item-text comment">Cause : <br ><b><?php echo (isset($ip['Alerte']['Cause'])) ? $ip['Alerte']['Cause'] : null; ?></b></p>

            <h3 class="list-group-item-heading">Terrains interrogés <a href="#" class = "btn-show-ip notinpdf">
        <span class="glyphicon glyphicon-pencil"></span>
        </a><br /></h3>
            <?php 
            if (isset($ip['fields'])) { 
                foreach ($ip['fields'] as $i => $f) {
                ?> 
                <h4 class="list-group-item-heading">#<?php echo $i+1;?> <?php echo $f['Nom'];?> [<?php echo $f['start_date']->format('H:i:s');?>]</h4>
                <?php if (isset($f['updates'])) : ?>
                    <?php foreach($f['updates'] as $updates) :?>
                    <p class="list-group-item-text comment"><?php echo $updates['text'];?></p>
                    <?php endforeach; endif;?>
                <?php
                }
            }
            ?> 
        <h3 class="list-group-item-heading notinpdf">Actions</h3>

        <a href="#" class = "btn-print-ip notinpdf">
        <!-- <span class="glyphicon glyphicon-pencil"></span> -->
        Imprimer
        </a><br />
        <a href="#" class = "btn-mail-ip notinpdf">
        <!-- <span class="glyphicon glyphicon-pencil"></span> -->
        Courriel
        </a><br />
        <a href="#mdl-end-ip" data-toggle="modal" class = "btn-end-ip notinpdf">
        <!-- <span class="glyphicon glyphicon-pencil"></span> -->
        Clôturer
        </a>
    </div>
</li>