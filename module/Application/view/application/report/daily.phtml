<?php
    $formatterJour = \IntlDateFormatter::create(\Locale::getDefault(),
            \IntlDateFormatter::FULL,
            \IntlDateFormatter::FULL,
            'UTC',
            \IntlDateFormatter::GREGORIAN,
            'dd LLLL');
    $formatterHeure = \IntlDateFormatter::create(\Locale::getDefault(),
            \IntlDateFormatter::FULL,
            \IntlDateFormatter::FULL,
            'UTC',
            \IntlDateFormatter::GREGORIAN,
            'HH:mm');
?>

<html>
    <head>
        <style>
            .text-center {
                text-align: center;
            }

            .push-left {
                float: left;
            }

            #header {
                width: 21cm;
            }

            #logo, #head-title {
                display: inline;
            }

            #title {
                font-size: large;
            }

            .table th, .table td {
                border: 1px solid;
            }

            table {
                width: 100%;
            }

            #header table tr td:first-child {
                width: 5%;
            }

            .cat_title {
                text-decoration: underline;
                font-size: medium;
            }
            
            .event_name {
                font-style: italic;
            }

        </style>
    </head>

    <body>
        <div id="header">
            <table>
                <tr>
                    <td> <img src="<?php echo __DIR__ ?>/../../../../../public/img/logo-dsna.png"></img></td>
                </tr>
            </table>
        </div>
        <div id="title" class="text-center">
            <h1>Rapport du <?php echo $formatterJour->format(new \DateTime($this->day)); ?></h1>
        </div>
        <div id="report">
        <?php
            $cat = null;
            foreach ($this->events as $event){
                if($cat == null || $cat !== $event->getCategory()->getName()){
                    $cat = $event->getCategory()->getName();
                    echo '<div class="cat_title">'.$cat.'</div>';
                }
                echo '<p class="event_name">'.$this->eventName($event);
                if($event->isPunctual()){
                    echo ' à '.$formatterHeure->format($event->getStartDate()).".";
                } else {
                    if($event->getEndDate()){
                        echo ' du '.$formatterJour->format($event->getStartDate()).' '.$formatterHeure->format($event->getStartdate()).
                             ' au'.$formatterJour->format($event->getEndDate()).' '.$formatterHeure->format($event->getEnddate());
                    } else {
                        echo ' à partir du '.$formatterJour->format($event->getStartDate()).' '.$formatterHeure->format($event->getStartdate());
                    }
                }
                echo '</p>';
                
            }
        ?>
        </div>
    </body>
</html>
