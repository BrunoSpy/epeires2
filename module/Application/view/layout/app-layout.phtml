<?php echo $this->doctype(); ?>

<html lang="fr">
    <head>
        <meta charset="utf-8">
        <?php echo $this->headTitle($this->translate('Epeires²'))->setSeparator(' - ')->setAutoEscape(false) ?>

        <?php echo $this->headMeta()->appendName('viewport', 'width=device-width, initial-scale=1.0') ?>

        <!-- Le styles -->
        <?php echo $this->headLink(array('rel' => 'shortcut icon', 'type' => 'image/vnd.microsoft.icon', 'href' => $this->basePath() . '/img/favicon.ico'))
                        ->prependStylesheet($this->basePath() . '/css/application.css') 
                        ->prependStylesheet($this->basePath() . '/css/timeline.css')
                        ->prependStylesheet($this->basePath() . '/css/bootstrap-switch.css')
                        ->prependStylesheet($this->basePath() . '/css/bootstrap-responsive.min.css')
                        ->prependStylesheet($this->basePath() . '/css/bootstrap.min.css')
                        ->prependStylesheet($this->basePath() . '/css/jquery-ui.min.css')
        				?>

        <!-- Scripts -->
        <?php echo $this->headScript()->prependFile($this->basePath() . '/js/timeline.js')
        							  ->prependFile($this->basePath() . '/js/headerbar.js')
        							  ->prependFile($this->basePath() . '/js/search.js')
        							  ->prependFile($this->basePath() . '/js/form.js')
        							  ->prependFile($this->basePath() . '/js/application.js')
        							  ->prependFile($this->basePath() . '/js/jquery.mousewheel.js')
        							  ->prependFile($this->basePath() . '/js/bootstrap-switch.js')
        							  ->prependFile($this->basePath() . '/js/html5.js', 'text/javascript', array('conditional' => 'lt IE 9',))
                                      ->prependFile($this->basePath() . '/js/bootstrap.min.js')
                                      ->prependFile($this->basePath() . '/js/noty/themes/default.js')
                                      ->prependFile($this->basePath() . '/js/noty/layouts/bottomRight.js')
                                      ->prependFile($this->basePath() . '/js/noty/jquery.noty.js')
                                      ->prependFile($this->basePath() . '/js/jquery-ui.min.js')
                                      ->prependFile($this->basePath() . '/js/jquery.min.js')
        							   ?>

    </head>
    <body>
    	<div class="header">
    		<ul class="inline">
    				<?php echo $this->userMenu(); ?>
    				<?php if($this->zoneform) :?>
    				<li><i class="icon-filter"></i><b> Zone : </b></li>
    				<li><?php 
    						$form = $this->zoneform;
    						$form->setAttributes(array('action' => $this->url('application', array('controller'=>'events', 'action'=>'savezone')),
												'class'=>''));
    						$form->prepare();
    						echo $this->form()->openTag($form);
    						echo $this->formSelect($form->get('zone'));
    						echo $this->form()->closeTag();
    					?>
    				</li>
    				<?php  endif;?>
    				<li><i class="icon-eye-open"></i><b> Chef de salle : </b>Prénom Nom</li>
    				<li><i class="icon-warning-sign"></i><b> IPO : </b><?php echo $this->ipo();?></li>
    				<li id="clock" class="pull-right"></li>
    		</ul>
    		
    	</div>
    	<div class="navbar navbar-after-top">
    		<div class="navbar-inner">
    			<ul class="nav pull-left">
    				<?php if($this->isGranted('events.create')):?>
    				<li>
    					<a href="#" id="create-link"><i class="icon-pencil"></i> <i class="icon-chevron-down"></i></a>
    				</li>
    				<?php endif;?>
    			</ul>
	        	<ul class="nav-centered nav">
	            	<li class="dropdown active">  <!-- lien par défaut, classe "active" supprimée par jquery si besoin -->
	            		<a id="home" class="dropdown-toggle" data-toggle="dropdown" href="<?php echo $this->url('application', array('controller'=>'events', 'action'=>'index'))?>"><i class="icon-home"></i> Évènements <b class="caret"></b></a>
	            		<ul class="dropdown-menu">
	            			<li class="nav-header">Tri</li>
	            			<li class="active"><a href="#" id="tri_cat">Par catégorie</a></li>
	            			<li><a id="tri_deb" href="#">Par heure de début</a></li>
	            			<li class="divider"></li>
	            			<li class="nav-header">Filtre</li>
	            			<li class="active"><a href="#" id="tri_std">Tous les évènements</a></li>
	            			<li><a id="tri_impt" href="#">Évènements importants uniquement</a></li>
	            		</ul>
	            		
	            	</li>
	            	<li class="divider-vertical"></li>
	            	<li><a href="<?php echo $this->url('application', array('controller'=>'radars', 'action'=>'index')) ?>">Radars</a></li>
	            	<li><a href="<?php echo $this->url('application', array('controller'=>'frequencies', 'action'=>'index')) ?>">Fréquences</a></li>
	        	</ul>
	        	<ul class="nav pull-right">
	        		<li>
	        			<form class="navbar-search" id="search">
	        				<input name="search" class="search-query" type="text" placeholder="Chercher"></input>
	        			</form>
	        		</li>
	        		<li>
	        			<div id="zoom" class="make-switch switch-small nav-in" data-on-label="Jour" data-off-label="6h" data-off="success" data-on="info" data-text-label="Zoom">
							<input type="checkbox">
						</div>
					</li>
					<li>
						<div id="cpt_evts">0</div>
					</li>
	        	</ul>
        	</div>
        </div>
        
        <?php if($this->isGranted('events.create') || $this->isGranted('events.write')):?>
		<div id="create-evt" class="popover fade bottom in">
			<div class="arrow"></div>
			<div class="loading"></div>
			<h3 class="popover-title" id="form-title">Nouvel évènement</h3>
			<div id="event">
				<div>Chargement...</div>
				<!-- formulaire createform.phtml récupéré via ajax -->
			</div>
		</div>
		<?php endif; ?>

		<div id="search-results" class="popover fade bottom in">
			<div class="arrow"></div>
			<div class="loading"></div>
			<div id="results">
				<div>Chargement...</div>
			</div>
		</div>


		<div id="suggest-evt" class="popover fade right in">
			<div class="arrow"></div>
			<h3 class="popover-title">Suggestions :</h3>
			<div id="suggests">
				<div>Chargement...</div>
			</div>
		</div>
        
        <div class="content">
            <?php echo $this->content; ?>
        </div> <!-- /container -->
        
        <?php 
		if(!$this->zfcuserIdentity()){
				echo $this->modalWindow("loginwindow", "<h3>Connexion</h3>", "", $this->zfcUserLoginWidget(array('redirect'=>$this->serverUrl(true))));
		} ?>
        
        <?php $this->inlineScript()->captureStart();?>


		//search
		search('<?php echo $this->url('application', array('controller'=>'events'));?>');
	
		//init form
		form('<?php echo $this->url('application', array('controller' => 'events'));?>');
		
		//init header bar
		headerbar('<?php echo $this->url('application', array('controller' => 'events'));?>');
		
		<?php $this->inlineScript()->captureEnd();?>
        
        
        <?php echo $this->inlineScript() ?>
    </body>
</html>
